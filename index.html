
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Cody.W的终极BLOG</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="暂无描述，哈">
<meta property="og:type" content="website">
<meta property="og:title" content="Cody.W的终极BLOG">
<meta property="og:url" content="http://zijianwang.xyz/index.html">
<meta property="og:site_name" content="Cody.W的终极BLOG">
<meta property="og:description" content="暂无描述，哈">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Cody.W的终极BLOG">
<meta name="twitter:description" content="暂无描述，哈">
  
    <link rel="alternative" href="/atom.xml" title="Cody.W的终极BLOG" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  <!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]-->
  
</head>
<body>
<div id="container">
  <div id="wrap">
    <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Cody.W的终极BLOG</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">欢迎大家来讨论</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="http://www.baidu.com/baidu" method="get" accept-charset="utf-8" class="search-form">
          <input type="search" name="word" maxlength="20" class="search-form-input" placeholder="Search">
          <input type="submit" value="" class="search-form-submit">
          <input name=tn type=hidden value="bds">
          <input name=cl type=hidden value="3">
          <input name=ct type=hidden value="2097152">
          <input type="hidden" name="si" value="zijianwang.xyz">
        </form>
      </div>
    </div>
  </div>
</header>
    <div class="outer">
      <section id="main">
  
    <article id="post-Android-Dev-The-simple-user-of-Retrofit-Http-Client" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/05/22/Android-Dev-The-simple-user-of-Retrofit-Http-Client/" class="article-date">
  <time datetime="2015-05-22T23:49:54.000Z" itemprop="datePublished">2015-05-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/05/22/Android-Dev-The-simple-user-of-Retrofit-Http-Client/">Andriod集成Retrofit网络请求库指南指南</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>近期我在我们的项目中大量的集成了Retrofit网络请求框架，经过了对Retrofit几天的了解，感觉这个库确实很强大很好用。</p>
<p>而鉴于目前网上一些中文Retrofit的指南我个人认为都不是很详尽（大多只是将官方文档用中文翻译了一下），即便是Retrofit官方指南也没有把大家可能常用到的API解释详尽。</p>
<p>所以本文意在给大家更加详细的讲解如何简单的使用Retrofit。鉴于本人技术有限，对Retrofit的实现原理以及源码等分析做的并不透彻，只是向大家简要介绍Retrofit的使用，使得像我一样的新手能够快速的上手入门。也希望大家向我提出宝贵的意见。</p>
<hr>
<p>有关更多API文档的查阅请大家到<a href="http://square.github.io/retrofit/" target="_blank" rel="external">Retrofit官网</a>查看。</p>
<p>以下，我将以我们的产品“<a href="http://sj.qq.com/myapp/detail.htm?apkName=com.cxtimes.zhixue" target="_blank" rel="external">知学</a>”中所用到的一些网络请求来为大家阐述Retrofit的简单使用。</p>
<p>对Retrofit而言，有两个类是非常关键的，那就是RestAdapter和我们自定义的接口（在知学中叫做ZhixueApi），前者的的作用有很多，但我们我们必然会用到的就是<strong>指定我们请求网络的主域名</strong>。而后者则负责封装我们在项目中要用到的每一个接口。</p>
<p>首先我们来简单了解下关于ZhixueApi的定义。在这个类中，我会介绍我们用到的几种提交方式以及参数的拼装形式。</p>
<p>另外，在我们的应用中并没有用到GET提交方式，有关的信息在官方指南中也阐述的比较清晰，本文便不在单独讨论GET提交方式。</p>
<pre><code>
public interface ZhixueApi {

    //1. 无参数post请求, 这里的Coupon则是用来解析服务器返回Json字符串的javabean类, Retrofit默认使用Gson解析
    @POST("/interface/xxxxxx")
    void getCouponList(Callback&lt;Coupon&gt; reponse);

    //2. 一个或几个参数的post请求
    // 注: 如果使用官方指南中提到的@Query和@QueryMap对参数进行封装, 那么默认会将参数拼到URL之中
    // 首先并不建议将参数拼如URL, 其次由于编码原因, 如果选择采用@Query或者@QueryMap类型的注解, 则参数中必然不能有中文
    // 其次如果使用@Query或者@QueryMap, 也就不能使用@FormUrlEncoded注解, 否则参数会消失
    // 如果使用了@FormUrlEncoded注解, 则必须使用@Field或者@FieldMap注解来作为参数
    @FormUrlEncoded
       @POST("/interface/xxxxxx")
       void getCourseList(@Field("userId") String userId, @Field("orderId") String orderId, Callback&lt;Coupon&gt; response);

    //3. 通过@FieldMap注解来封装参数
    //注: 如果你的参数只有一个或者两三个, 那么用@Field就基本足够了, 但如果你的参数非常之多, 七八个甚至十几个
    //那么我们就可以用一个Map去封装, 通过key-value的形式封装好Map对象后再传入, 代码会相对整洁, 在做参数传递的时候也不至于乱套
    @FormUrlEncoded
    @POST("/interface/xxxxxx")
       void getCourseList(@FieldMap Map&lt;String,String&gt; paramsMap, Callback&lt;Coupon&gt; response);

    //4. 提交multipart请求
    // 注: 如果我们要提交用户拍的的照片, 或者是录好的语音, 那么我们就要用到@Multipart这个注解了
    // 在使用Multipart的时候, 注意参数的注解必须是@Part或者@PartMap 
    // @PartMap和上面的@FieldMap类似, 都是通过Map封装好参数, 就不过多解释了.
    @Multipart
       @POST("/interface/photoUpload_servlet")
       void submitUserPhoto(@Part("userId") String userId, @Part("file") TypedFile file, Callback&lt;Coupon&gt; response response);
}

</code></pre>

<p>而对于上传文件, 我们需要将我们所需上传的File文件转换成TypedFile形式, 在Retrofit中也很简单</p>
<pre><code>
//首先定义一个mimeType类型, 如果我要上传的是一张图片, 就按如下定义
String mimeType = "image/jpg";
//String mimeType = "audio/m4a";//如果是m4a的声音文件, 就这么定义
TypedFile typedFile = new TypedFile(mimeType, file);//调用这个方法将文件转为TypedFile形势, 传参上传即可

</code></pre>

<p>以下这个类是我封装的ZhixueApiUtil，作用是在每次请求接口的时候能够快速的拿到ZhixueApi的实例，所以我在此设计了一个简单的单例模式。</p>
<pre><code>
public class ZhixueApiUtil {

    private static ZhixueApiUtil mInstance;
    //此前定义的接口的实例
    private ZhixueApi zhixueApi;
    //我们的主域名
    private static final String HOST = "http://111.111.111.111";
    //构造函数
    private ZhixueApiUtil() {
        //在构造函数中我们要通过实例化RestAdapter拿到我们的ZhixueApi
        //注: setRequestInterceptor()在这里是为了在请求头中加入设备信息, 方便我们后台的调试
        RestAdapter restAdapter = new RestAdapter.Builder().setRequestInterceptor(defaultInterceptor).setEndpoint(HOST).build();
        zhixueApi = restAdapter.create(ZhixueApi.class);
    }

    //一个简单的单例
    public static ZhixueApiUtil getInstance() {
        if (mInstance == null) {
            mInstance = new ZhixueApiUtil();
        }
        return mInstance;
    }

    public ZhixueApi getZhixueApi() {
        return zhixueApi;
    }

    //在这里我们还定义了一个RequestInterceptor, 作用是在请求头中拼入一些信息方便我们后台的调试
    //否则请求头中就只会出现okhttp 2.2.0的字样(Retrofit默认是直接使用OkhttpClient的)
    RequestInterceptor defaultInterceptor = new RequestInterceptor() {
        @Override
        public void intercept(RequestFacade request) {
            request.addHeader("User-Agent", "some code here");
        }
    };
}
</code></pre>

<p>而当我们手握这两个类的时候, 请求接口就会变得异常的简单</p>
<pre><code>
//例如

ZhixueApiUtil.getInstance().getZhixueApi().getCourseList(paramsMap, new Callback&lt;Coupon&gt;(){

    @Override
    public void success(Coupon coupn, Response response) {
        //在这里Json已经通过Retrofit中含有的Gson包为我们解析好了, 直接拿出来用就好了!
        ...
    }

    @Override
    public void failure(RetrofitError error) {
        Log.d(TAG, error.getMessage());
        ...
    }
});
</code></pre>

<h3 id="到这里，相信大家已经能够基本使用Retrofit了，本人代码经验尚浅，文中有什么不足希望大家多提宝贵意见。">到这里，相信大家已经能够基本使用Retrofit了，本人代码经验尚浅，文中有什么不足希望大家多提宝贵意见。</h3><p>后面我会分享一些Retrofit配合Okhttp配合Stetho配合Chrome做网络调试的经验，以及Retrofit请求网络的速度对比分析。依然都会是一些入门的东西，意在让大家快速的用起来，而更深层次的东西，还需要大家自己多学习，多探讨。</p>
<p>最后的最后，也欢迎大家关注我们正在做的事儿：<a href="http://sj.qq.com/myapp/detail.htm?apkName=com.cxtimes.zhixue" target="_blank" rel="external">知学，一个大学生家教O2O平台</a>，当然这个App在制作上仍然有很多的不足，有希望大家多提宝贵意见。</p>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="http://zijianwang.xyz/2015/05/22/Android-Dev-The-simple-user-of-Retrofit-Http-Client/" data-id="cia29sg160000bqfy3j3406ip" class="article-share-link" data-share="baidu">Share</a>
      

      

      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Andriod/">Andriod</a></li></ul>

    </footer>
  </div>
  
</article>


  
  
</section>
      
      <aside id="sidebar">
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Andriod/">Andriod</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Andriod/" style="font-size: 10px;">Andriod</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">May 2015</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2015/05/22/Android-Dev-The-simple-user-of-Retrofit-Http-Client/">Andriod集成Retrofit网络请求库指南指南</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Links</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="http://xiguabaobao.com" target="_blank">主题作者</a>
          </li>
        
          <li>
            <a href="http://reqianduan.com" target="_blank">热前端</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
      
    </div>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2015 Zijian Wang<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
      .
      Theme by <a href="https://github.com/xiangming/landscape-plus" target="_blank">Landscape-plus</a>
    </div>
  </div>
</footer>
  </div>
  <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
  <!-- totop start -->
<div id="totop">
<a title="totop"><img src="/img/scrollup.png"/></a>
</div>

<!-- totop end -->


<!-- 百度分享 start -->

<div id="article-share-box" class="article-share-box">
  <div id="bdshare" class="bdsharebuttonbox article-share-links">
    <a class="article-share-weibo" data-cmd="tsina" title="分享到新浪微博"></a>
    <a class="article-share-weixin" data-cmd="weixin" title="分享到微信"></a>
    <a class="article-share-qq" data-cmd="sqq" title="分享到QQ"></a>
    <a class="article-share-renren" data-cmd="renren" title="分享到人人网"></a>
    <a class="article-share-more" data-cmd="more" title="更多"></a>
  </div>
</div>
<script>window._bd_share_config={"common":{},"share":{"bdCustomStyle":"/css/bdshare.css"}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?cdnversion='+~(-new Date()/36e5)];</script>

<!-- 百度分享 end -->

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>




<script src="/js/script.js" type="text/javascript"></script>

</div>
</body>
</html>
